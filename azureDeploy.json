{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]"
    },
    "containerStackName": {
      "type": "string",
      "defaultValue": "open-amt-cloud-toolkit"
    },
    "registry": {
      "type": "string",
      "metadata": {
        "description": "Name of the Registry."
      }
    },
    "registryUsername": {
      "type": "securestring",
      "metadata": {
        "description": "Username for the registry"
      }
    },
    "registryPassword": {
      "type": "securestring",
      "metadata": {
        "description": "Password for the registry"
      }
    },
    "vaultToken": {
      "defaultValue": "myroot",
      "type": "securestring"
    },
    "rpsImageName": {
      "defaultValue": "rps:latest",
      "type": "string",
      "metadata": {
        "description": "Name of the RPS image to deploy from specified registry"
      }
    },
    "mpsImageName": {
      "defaultValue": "mps:latest",
      "type": "string",
      "metadata": {
        "description": "Name of the MPS image to deploy from specified registry"
      }
    },
    "sampleWebUIImageName": {
      "defaultValue": "webui:latest",
      "type": "string",
      "metadata": {
        "description": "Name of the Sample WebUI image to deploy from specified registry"
      }
    },
    "fqdn": {
      "type": "string",
      "metadata": {
        "description": "Name of the FQDN you wish to use to access this deployment (i.e. \"sample\" will result in an FQDN of sample.westus.azurecontainer.io)"
      }
    },
    "useAllowlist": {
      "defaultValue": "false",
      "type": "string",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsAdminUsername": {
      "defaultValue": "standalone",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsAdminPassword": {
      "defaultValue": "G@ppm0ym",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsUsername": {
      "defaultValue": "standalone",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "mpsPassword": {
      "defaultValue": "G@ppm0ym",
      "type": "securestring",
      "metadata": {
        "description": "For details on this property view the configuration documentation located under \"Microservices\" in the Open AMT Cloud Toolkit documentation on https://open-amt-cloud-toolkit.github.io/docs/"
      }
    },
    "tokenExpiration": {
      "defaultValue": "1440",
      "type": "string",
      "metadata": {
        "description": "Specifies the duration (in minutes) that a token will be valid for"
      }
    }
  },
  "resources": [
    {
      "type": "Microsoft.ContainerInstance/containerGroups",
      "apiVersion": "2019-12-01",
      "name": "[parameters('containerStackName')]",
      "location": "[parameters('location')]",
      "properties": {
        "sku": "Standard",
        "containers": [
          {
            "name": "rps",
            "properties": {
              "image": "[concat(parameters('registry'), '/', parameters('rpsImageName'))]",
              "ports": [
                {
                  "port": 8080
                },
                {
                  "port": 8081
                }
              ],
              "environmentVariables": [
                {
                  "name": "RPS_USER",
                  "value": "[parameters('mpsUsername')]"
                },
                {
                  "name": "RPS_PASSWORD",
                  "value": "[parameters('mpsPassword')]"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          },
          {
            "name": "mps",
            "properties": {
              "image": "[concat(parameters('registry'), '/', parameters('mpsImageName'))]",
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              },
              "environmentVariables": [
                {
                  "name": "MPS_COMMON_NAME",
                  "value": "[concat(parameters('fqdn'), '.', parameters('location'),'.azurecontainer.io')]"
                },
                {
                  "name": "MPS_USE_ALLOWLIST",
                  "value": "[parameters('useAllowlist')]"
                },
                {
                  "name": "MPS_WEB_ADMIN_USER",
                  "value": "[parameters('mpsAdminUsername')]"
                },
                {
                  "name": "MPS_WEB_ADMIN_PASSWORD",
                  "value": "[parameters('mpsAdminPassword')]"
                },
                {
                  "name": "MPS_USERNAME",
                  "value": "[parameters('mpsUsername')]"
                },
                {
                  "name": "MPS_PASS",
                  "value": "[parameters('mpsPassword')]"
                },
                {
                  "name": "MPS_JWT_EXPIRATION",
                  "value": "[parameters('tokenExpiration')]"
                }
              ],
              "ports": [
                {
                  "port": 4433
                },
                {
                  "port": 3000
                }
              ]
            }
          },
          {
            "name": "webui",
            "properties": {
              "image": "[concat(parameters('registry'), '/', parameters('sampleWebUIImageName'))]",
              "ports": [
                {
                  "port": 80
                }
              ],
              "environmentVariables": [
                {
                  "name": "MPS_SERVER",
                  "value": "[concat('https://',parameters('fqdn'), '.', parameters('location'), '.azurecontainer.io:8443/mps')]"
                },
                {
                  "name": "RPS_SERVER",
                  "value": "[concat('https://',parameters('fqdn'), '.', parameters('location'), '.azurecontainer.io:8443/rps')]"
                }
              ],
              "volumeMounts": [
                {
                  "name": "nginx-config",
                  "mountPath": "/etc/nginx/conf.d"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          },
          {
            "name": "vault",
            "properties": {
              "image": "vault:latest",
              "environmentVariables": [
                {
                  "name": "VAULT_DEV_ROOT_TOKEN_ID",
                  "value": "[parameters('vaultToken')]"
                },
                {
                  "name": "VAULT_DEV_LISTEN_ADDRESS",
                  "value": "0.0.0.0:8200"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          },
          {
            "name": "kong",
            "properties": {
              "image": "kong:2.3",
              "ports": [
                {
                  "port": 8443
                }
              ],
              "command": [
                "kong",
                "start",
                "--vv"
              ],
              "environmentVariables": [
                {
                  "name": "KONG_DATABASE",
                  "value": "off"
                },
                {
                  "name": "KONG_CASSANDRA_CONTACT_POINTS",
                  "value": "kong-database"
                },
                {
                  "name": "KONG_ADMIN_LISTEN",
                  "value": "0.0.0.0:8001"
                },
                {
                  "name": "KONG_ADMIN_LISTEN_SSL",
                  "value": "0.0.0.0:8444"
                },
                {
                  "name": "KONG_NGINX_DAEMON",
                  "value": "off"
                },
                {
                  "name": "KONG_DECLARATIVE_CONFIG",
                  "value": "/home/kong/kong.yaml"
                },
                {
                  "name": "KONG_LOG_LEVEL",
                  "value": "debug"
                }
              ],
              "volumeMounts": [
                {
                  "name": "kong-config",
                  "mountPath": "/home/kong/"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          },
          {
            "name": "db",
            "properties": {
              "image": "postgres:latest",
              "ports": [
                {
                  "port": 5432
                }
              ],
              "environmentVariables": [
                {
                  "name": "POSTGRES_DB",
                  "value": "rpsdb"
                },
                {
                  "name": "POSTGRES_USER",
                  "value": "postgresadmin"
                },
                {
                  "name": "POSTGRES_PASSWORD",
                  "value": "admin123"
                }
              ],
              "volumeMounts": [
                {
                  "name": "db-config",
                  "mountPath": "/docker-entrypoint-initdb.d"
                }
              ],
              "resources": {
                "requests": {
                  "cpu": 0.5,
                  "memoryInGb": 1.0
                }
              }
            }
          }
        ],
        "osType": "Linux",
        "restartPolicy": "OnFailure",
        "imageRegistryCredentials": [
          {
            "server": "[parameters('registry')]",
            "username": "[parameters('registryUsername')]",
            "password": "[parameters('registryPassword')]"
          }
        ],
        "ipAddress": {
          "ip": "168.61.3.88",
          "dnsNameLabel": "[parameters('fqdn')]",
          "type": "Public",
          "ports": [
            {
              "protocol": "tcp",
              "port": 4433
            },
            {
              "protocol": "tcp",
              "port": 80
            },
            {
              "protocol": "tcp",
              "port": 8443
            }
          ]
        },
        "volumes": [
          {
            "name": "db-config",
            "secret": {
              "init.sql": "Q1JFQVRFIEVYVEVOU0lPTiBJRiBOT1QgRVhJU1RTIGNpdGV4dDsNCkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGNpcmFjb25maWdzKA0KICAgICAgY2lyYV9jb25maWdfbmFtZSBjaXRleHQgTk9UIE5VTEwsDQogICAgICBtcHNfc2VydmVyX2FkZHJlc3MgdmFyY2hhcigyNTYpLA0KICAgICAgbXBzX3BvcnQgaW50ZWdlciwNCiAgICAgIHVzZXJfbmFtZSB2YXJjaGFyKDQwKSwNCiAgICAgIHBhc3N3b3JkIHZhcmNoYXIoNjMpLA0KICAgICAgZ2VuZXJhdGVfcmFuZG9tX3Bhc3N3b3JkIEJPT0xFQU4gTk9UIE5VTEwsDQogICAgICByYW5kb21fcGFzc3dvcmRfbGVuZ3RoIGludGVnZXIsDQogICAgICBjb21tb25fbmFtZSB2YXJjaGFyKDI1NiksDQogICAgICBzZXJ2ZXJfYWRkcmVzc19mb3JtYXQgaW50ZWdlciwgDQogICAgICBhdXRoX21ldGhvZCBpbnRlZ2VyLCANCiAgICAgIG1wc19yb290X2NlcnRpZmljYXRlIHRleHQsIA0KICAgICAgcHJveHlkZXRhaWxzIHRleHQsDQogICAgICBDT05TVFJBSU5UIGNvbmZpZ25hbWUgVU5JUVVFKGNpcmFfY29uZmlnX25hbWUpDQogICAgKTsNCkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIG5ldHdvcmtjb25maWdzKA0KICAgICAgbmV0d29ya19wcm9maWxlX25hbWUgY2l0ZXh0IE5PVCBOVUxMLA0KICAgICAgZGhjcF9lbmFibGVkIEJPT0xFQU4gTk9UIE5VTEwsDQogICAgICBzdGF0aWNfaXBfc2hhcmVkIEJPT0xFQU4gTk9UIE5VTEwsDQogICAgICBpcF9zeW5jX2VuYWJsZWQgQk9PTEVBTiBOT1QgTlVMTCwNCiAgICAgIENPTlNUUkFJTlQgbmV0d29ya3Byb2ZpbGVuYW1lIFVOSVFVRShuZXR3b3JrX3Byb2ZpbGVfbmFtZSkNCiAgICApOw0KQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcHJvZmlsZXMoDQogICAgICBwcm9maWxlX25hbWUgY2l0ZXh0IE5PVCBOVUxMLA0KICAgICAgYWN0aXZhdGlvbiB2YXJjaGFyKDIwKSBOT1QgTlVMTCwNCiAgICAgIGFtdF9wYXNzd29yZCB2YXJjaGFyKDQwKSwNCiAgICAgIGNvbmZpZ3VyYXRpb25fc2NyaXB0IHRleHQsDQogICAgICBjaXJhX2NvbmZpZ19uYW1lIGNpdGV4dCBSRUZFUkVOQ0VTIGNpcmFjb25maWdzKGNpcmFfY29uZmlnX25hbWUpLA0KICAgICAgZ2VuZXJhdGVfcmFuZG9tX3Bhc3N3b3JkIEJPT0xFQU4gTk9UIE5VTEwsDQogICAgICByYW5kb21fcGFzc3dvcmRfY2hhcmFjdGVycyB2YXJjaGFyKDEwMCksDQogICAgICByYW5kb21fcGFzc3dvcmRfbGVuZ3RoIGludGVnZXIsDQogICAgICBjcmVhdGlvbl9kYXRlIHRpbWVzdGFtcCwNCiAgICAgIGNyZWF0ZWRfYnkgdmFyY2hhcig0MCksDQogICAgICBuZXR3b3JrX3Byb2ZpbGVfbmFtZSBjaXRleHQgUkVGRVJFTkNFUyBuZXR3b3JrY29uZmlncyhuZXR3b3JrX3Byb2ZpbGVfbmFtZSksDQogICAgICBtZWJ4X3Bhc3N3b3JkIHZhcmNoYXIoNDApLA0KICAgICAgZ2VuZXJhdGVfcmFuZG9tX21lYnhfcGFzc3dvcmQgQk9PTEVBTiBOT1QgTlVMTCwNCiAgICAgIHJhbmRvbV9tZWJ4X3Bhc3N3b3JkX2xlbmd0aCBpbnRlZ2VyLA0KICAgICAgdGFncyB0ZXh0W10sDQogICAgICBDT05TVFJBSU5UIG5hbWUgVU5JUVVFKHByb2ZpbGVfbmFtZSkNCiAgICApOw0KQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgZG9tYWlucygNCiAgICAgIG5hbWUgY2l0ZXh0IE5PVCBOVUxMLA0KICAgICAgZG9tYWluX3N1ZmZpeCBjaXRleHQgTk9UIE5VTEwsDQogICAgICBwcm92aXNpb25pbmdfY2VydCB0ZXh0LA0KICAgICAgcHJvdmlzaW9uaW5nX2NlcnRfc3RvcmFnZV9mb3JtYXQgdmFyY2hhcig0MCksDQogICAgICBwcm92aXNpb25pbmdfY2VydF9rZXkgdGV4dCwNCiAgICAgIGNyZWF0aW9uX2RhdGUgdGltZXN0YW1wLA0KICAgICAgY3JlYXRlZF9ieSB2YXJjaGFyKDQwKSwNCiAgICAgIENPTlNUUkFJTlQgZG9tYWlubmFtZSBVTklRVUUobmFtZSksDQogICAgICBDT05TVFJBSU5UIGRvbWFpbnN1ZmZpeCBVTklRVUUoZG9tYWluX3N1ZmZpeCkNCiAgICApOw0KDQpDUkVBVEUgVU5JUVVFIElOREVYIGxvd2VyX2NpcmFfY29uZmlnX25hbWVfaWR4IE9OIGNpcmFjb25maWdzICgobG93ZXIoY2lyYV9jb25maWdfbmFtZSkpKTsNCkNSRUFURSBVTklRVUUgSU5ERVggbG93ZXJfbmV0d29ya19wcm9maWxlX25hbWVfaWR4IE9OIG5ldHdvcmtjb25maWdzICgobG93ZXIobmV0d29ya19wcm9maWxlX25hbWUpKSk7DQpDUkVBVEUgVU5JUVVFIElOREVYIGxvd2VyX3Byb2ZpbGVfbmFtZV9pZHggT04gcHJvZmlsZXMgKChsb3dlcihwcm9maWxlX25hbWUpKSk7DQpDUkVBVEUgVU5JUVVFIElOREVYIGxvd2VyX25hbWVfc3VmZml4X2lkeCBPTiBkb21haW5zICgobG93ZXIobmFtZSkpLCAobG93ZXIoZG9tYWluX3N1ZmZpeCkpKTsNCg0KSU5TRVJUIElOVE8gcHVibGljLm5ldHdvcmtjb25maWdzKA0KICBuZXR3b3JrX3Byb2ZpbGVfbmFtZSwgZGhjcF9lbmFibGVkLCBzdGF0aWNfaXBfc2hhcmVkLCBpcF9zeW5jX2VuYWJsZWQpIA0KICB2YWx1ZXMoJ2RoY3BfZGlzYWJsZWQnLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSk7DQpJTlNFUlQgSU5UTyBwdWJsaWMubmV0d29ya2NvbmZpZ3MoDQogIG5ldHdvcmtfcHJvZmlsZV9uYW1lLCBkaGNwX2VuYWJsZWQsIHN0YXRpY19pcF9zaGFyZWQsIGlwX3N5bmNfZW5hYmxlZCkgIA0KICB2YWx1ZXMoJ2RoY3BfZW5hYmxlZCcsIHRydWUsIGZhbHNlLCB0cnVlKTsNCg0KQ1JFQVRFIERBVEFCQVNFIG1wc2RiOw0KDQpcY29ubmVjdCBtcHNkYg0KDQpDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBkZXZpY2VzKA0KICAgICAgZ3VpZCB1dWlkIE5PVCBOVUxMLA0KICAgICAgdGFncyB0ZXh0W10sDQogICAgICBob3N0bmFtZSB2YXJjaGFyKDI1NiksDQogICAgICBtcHNpbnN0YW5jZSB0ZXh0LCANCiAgICAgIGNvbm5lY3Rpb25zdGF0dXMgYm9vbGVhbiwNCiAgICAgIG1wc3VzZXJuYW1lIHZhcmNoYXIoMTYpLA0KICAgICAgQ09OU1RSQUlOVCBkZXZpY2VfZ3VpZCBVTklRVUUoZ3VpZCkNCiAgICApOyANCg=="
            }
          },
          {
            "name": "nginx-config",
            "secret": {
              "nginx.conf": "c2VydmVyIHsNCiAgICBsaXN0ZW4gODAgZGVmYXVsdF9zZXJ2ZXI7DQogICAgbGlzdGVuIFs6Ol06ODAgZGVmYXVsdF9zZXJ2ZXI7DQogICAgc2VydmVyX25hbWUgXzsNCiANCg0KICAgIGxvY2F0aW9uIC8gew0KICAgICAgICByb290ICAgL3Vzci9zaGFyZS9uZ2lueC9odG1sOw0KICAgICAgICBpbmRleCAgaW5kZXguaHRtbCBpbmRleC5odG07DQogICAgfQ0KDQogICAgZXJyb3JfcGFnZSAgNDA0ICAgICAgICAgICAgICAvaW5kZXguaHRtbDsNCg0KICAgICMgcmVkaXJlY3Qgc2VydmVyIGVycm9yIHBhZ2VzIHRvIHRoZSBzdGF0aWMgcGFnZSAvNTB4Lmh0bWwNCiAgICAjDQogICAgZXJyb3JfcGFnZSAgIDUwMCA1MDIgNTAzIDUwNCAgLzUweC5odG1sOw0KICAgIGxvY2F0aW9uID0gLzUweC5odG1sIHsNCiAgICAgICAgcm9vdCAgIC91c3Ivc2hhcmUvbmdpbngvaHRtbDsNCiAgICB9DQp9DQoNCg=="
            }
          },
          {
            "name": "kong-config",
            "secret": {
              "kong.yaml": "IyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KIyBDb3B5cmlnaHQgKGMpIEludGVsIENvcnBvcmF0aW9uIDIwMTgtMjAxOQ0KIyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMA0KIyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQojIE1ldGFkYXRhIGZpZWxkcyBzdGFydCB3aXRoIGFuIHVuZGVyc2NvcmUgKF8pDQojIEZpZWxkcyB0aGF0IGRvIG5vdCBzdGFydCB3aXRoIGFuIHVuZGVyc2NvcmUgcmVwcmVzZW50IEtvbmcgZW50aXRpZXMgYW5kIGF0dHJpYnV0ZXMNCg0KIyBfZm9ybWF0X3ZlcnNpb24gaXMgbWFuZGF0b3J5LA0KIyBpdCBzcGVjaWZpZXMgdGhlIG1pbmltdW0gdmVyc2lvbiBvZiBLb25nIHRoYXQgc3VwcG9ydHMgdGhlIGZvcm1hdA0KDQpfZm9ybWF0X3ZlcnNpb246ICIyLjEiDQoNCiMgX3RyYW5zZm9ybSBpcyBvcHRpb25hbCwgZGVmYXVsdGluZyB0byB0cnVlLg0KIyBJdCBzcGVjaWZpZXMgd2hldGhlciBzY2hlbWEgdHJhbnNmb3JtYXRpb25zIHNob3VsZCBiZSBhcHBsaWVkIHdoZW4gaW1wb3J0aW5nIHRoaXMgZmlsZQ0KIyBhcyBhIHJ1bGUgb2YgdGh1bWIsIGxlYXZlIHRoaXMgc2V0dGluZyB0byB0cnVlIGlmIHlvdSBhcmUgaW1wb3J0aW5nIGNyZWRlbnRpYWxzDQojIHdpdGggcGxhaW4gcGFzc3dvcmRzLCB3aGljaCBuZWVkIHRvIGJlIGVuY3J5cHRlZC9oYXNoZWQgYmVmb3JlIHN0b3Jpbmcgb24gdGhlIGRhdGFiYXNlLg0KIyBPbiB0aGUgb3RoZXIgaGFuZCwgaWYgeW91IGFyZSByZWltcG9ydGluZyBhIGRhdGFiYXNlIHdpdGggcGFzc3dvcmRzIGFscmVhZHkgZW5jcnlwdGVkL2hhc2hlZCwNCiMgc2V0IGl0IHRvIGZhbHNlLg0KDQpfdHJhbnNmb3JtOiB0cnVlDQoNCiMgRWFjaCBLb25nIGVudGl0eSAoY29yZSBlbnRpdHkgb3IgY3VzdG9tIGVudGl0eSBpbnRyb2R1Y2VkIGJ5IGEgcGx1Z2luKQ0KIyBjYW4gYmUgbGlzdGVkIGluIHRoZSB0b3AtbGV2ZWwgYXMgYW4gYXJyYXkgb2Ygb2JqZWN0czoNCg0Kc2VydmljZXM6DQotIG5hbWU6IG1wcy1yZXN0DQogIGhvc3Q6IG1wc3JvdXRlcg0KICBwb3J0OiA4MDAzDQogIHRhZ3M6DQogIC0gbXBzDQogIHJvdXRlczoNCiAgLSBuYW1lOiBtcHMtbG9naW4tcm91dGUNCiAgICBzdHJpcF9wYXRoOiB0cnVlDQogICAgcGF0aHM6DQogICAgLSAvbXBzL2xvZ2luDQogIC0gbmFtZTogbXBzLXJlbGF5LXJvdXRlDQogICAgc3RyaXBfcGF0aDogdHJ1ZQ0KICAgIHBhdGhzOg0KICAgIC0gL21wcy93cw0KICAtIG5hbWU6IG1wcy1yb3V0ZQ0KICAgIHN0cmlwX3BhdGg6IHRydWUNCiAgICBwYXRoczoNCiAgICAtIC9tcHMNCg0KLSBuYW1lOiBycHMtcmVzdA0KICBob3N0OiBycHMNCiAgcG9ydDogODA4MSAgDQogIHRhZ3M6DQogIC0gcnBzDQogIHJvdXRlczoNCiAgLSBuYW1lOiBycHMtcm91dGUNCiAgICBzdHJpcF9wYXRoOiB0cnVlDQogICAgcGF0aHM6DQogICAgLSAvcnBzDQoNCi0gbmFtZTogcnBzLXdzDQogIGhvc3Q6IHJwcw0KICBwb3J0OiA4MDgwDQogIHRhZ3M6DQogIC0gcnBzDQogIHJvdXRlczoNCiAgLSBuYW1lOiBycHMtYWN0aXZhdGUtcm91dGUNCiAgICBzdHJpcF9wYXRoOiB0cnVlDQogICAgcGF0aHM6DQogICAgLSAvYWN0aXZhdGUNCg0KLSBuYW1lOiB3ZWINCiAgaG9zdDogd2VidWkNCiAgcG9ydDogODANCiAgdGFnczoNCiAgLSB3ZWINCiAgcm91dGVzOg0KICAtIG5hbWU6IHdlYi1yb3V0ZQ0KICAgIHBhdGhzOg0KICAgIC0gLw0KDQpwbHVnaW5zOg0KLSBuYW1lOiBjb3JzIA0KLSBuYW1lOiBqd3QNCiAgcm91dGU6IHJwcy1yb3V0ZQ0KICBjb25maWc6DQogICAgY2xhaW1zX3RvX3ZlcmlmeToNCiAgICAtIGV4cA0KLSBuYW1lOiBqd3QNCiAgcm91dGU6IG1wcy1yb3V0ZQ0KICBjb25maWc6DQogICAgY2xhaW1zX3RvX3ZlcmlmeToNCiAgICAtIGV4cA0KDQpjb25zdW1lcnM6DQogIC0gdXNlcm5hbWU6IGFkbWluDQpqd3Rfc2VjcmV0czoNCiAgLSBjb25zdW1lcjogYWRtaW4NCiAgICBrZXk6IDlFbVJKVGJJaUliNGJJZVNzbWdjV0lqclI2SHlFVHFjICNzYW1wbGUga2V5DQogICAgc2VjcmV0OiAiIg0KDQoNCg0KIyByb3V0ZXM6DQojIC0gbmFtZTogYW5vdGhlci1yb3V0ZQ0KIyAgICMgUmVsYXRpb25zaGlwcyBjYW4gYWxzbyBiZSBzcGVjaWZpZWQgYmV0d2VlbiB0b3AtbGV2ZWwgZW50aXRpZXMsDQojICAgIyBlaXRoZXIgYnkgbmFtZSBvciBieSBpZA0KIyAgIHNlcnZpY2U6IGV4YW1wbGUtc2VydmljZQ0KIyAgIGhvc3RzOiBbImhlbGxvLmNvbSJdDQoNCiMgY29uc3VtZXJzOg0KIyAtIHVzZXJuYW1lOiBleGFtcGxlLXVzZXINCiMgICAjIEN1c3RvbSBlbnRpdGllcyBmcm9tIHBsdWdpbiBjYW4gYWxzbyBiZSBzcGVjaWZpZWQNCiMgICAjIElmIHRoZXkgc3BlY2lmeSBhIGZvcmVpZ24ta2V5IHJlbGF0aW9uc2hwLCB0aGV5IGNhbiBhbHNvIGJlIG5lc3RlZA0KIyAgIGtleWF1dGhfY3JlZGVudGlhbHM6DQojICAgLSBrZXk6IG15LWtleQ0KIyAgIHBsdWdpbnM6DQojICAgLSBuYW1lOiByYXRlLWxpbWl0aW5nDQojICAgICBfY29tbWVudDogInRoZXNlIGFyZSBkZWZhdWx0IHJhdGUtbGltaXRzIGZvciB1c2VyIGV4YW1wbGUtdXNlciINCiMgICAgIGNvbmZpZzoNCiMgICAgICAgcG9saWN5OiBsb2NhbA0KIyAgICAgICBzZWNvbmQ6IDUNCiMgICAgICAgaG91cjogMTAwMDANCg0KIyBXaGVuIGFuIGVudGl0eSBoYXMgbXVsdGlwbGUgZm9yZWlnbi1rZXkgcmVsYXRpb25zaGlwcw0KIyAoZS5nLiBhIHBsdWdpbiBtYXRjaGluZyBvbiBib3RoIGNvbnN1bWVyIGFuZCBzZXJ2aWNlKQ0KIyBpdCBtdXN0IGJlIHNwZWNpZmllZCBhcyBhIHRvcC1sZXZlbCBlbnRpdHksIGFuZCBub3QgdGhyb3VnaA0KIyBuZXN0aW5nLg0KDQojIHBsdWdpbnM6DQojIC0gbmFtZTogcmF0ZS1saW1pdGluZw0KIyAgIGNvbnN1bWVyOiBleGFtcGxlLXVzZXINCiMgICBzZXJ2aWNlOiBhbm90aGVyLXNlcnZpY2UNCiMgICBfY29tbWVudDogImV4YW1wbGUtdXNlciBpcyBleHRyYSBsaW1pdGVkIHdoZW4gdXNpbmcgYW5vdGhlci1zZXJ2aWNlIg0KIyAgIGNvbmZpZzoNCiMgICAgIGhvdXI6IDINCiMgICAjIHRhZ3MgYXJlIGZvciB5b3VyIG9yZ2FuaXphdGlvbiBvbmx5IGFuZCBoYXZlIG5vIG1lYW5pbmcgZm9yIEtvbmc6DQojICAgdGFnczoNCiMgICAtIGV4dHJhX2xpbWl0cw0KIyAgIC0gbXlfdGFnDQo="
            }
          },
          {
            "name": "private",
            "emptyDir": {}
          }
        ]
      }
    }
  ]
}